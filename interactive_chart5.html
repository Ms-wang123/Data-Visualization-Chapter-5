<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬5ç« äº¤äº’å¼å›¾è¡¨æ¼”ç¤º - åŸå§‹ç‰ˆ</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        nav {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .nav-tabs {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .nav-tab {
            padding: 12px 24px;
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .nav-tab:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .nav-tab.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        main {
            padding: 30px;
        }
        
        .content-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .content-section.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .chart-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin: 20px auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            width: 100%;
            max-width: 1450px;
        }
        
        .chart-title {
            font-size: 1.5em;
            color: #333;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
        }
        
        .description {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .description h3 {
            color: #1976D2;
            margin-bottom: 10px;
        }
        
        .grid-layout {
            display: grid;
            gap: 20px;
            margin: 20px auto;
            width: 100%;
            max-width: 1400px;
        }
        
        .grid-2x2 { grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; }
        .grid-1x2 { grid-template-columns: 2fr 1fr; grid-template-rows: 2fr 1fr; }
        .grid-1x1 { grid-template-columns: 1fr; }
        
        .chart-wrapper {
            min-height: 450px;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        /* äº¤äº’æ§ä»¶æ ·å¼ */
        .interactive-controls {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border: 1px solid #e3e6ea;
        }
        
        .control-group {
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .control-group label {
            font-weight: 500;
            min-width: 120px;
        }
        
        .control-group input[type="range"],
        .control-group input[type="number"],
        .control-group select {
            padding: 8px 15px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .control-group input[type="range"] {
            flex: 1;
        }
        
        .control-group .value-display {
            min-width: 60px;
            text-align: center;
            font-weight: bold;
            color: #667eea;
        }
        
        .data-upload-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            margin: 15px 0;
            border-radius: 12px;
        }
        
        .upload-area {
            border: 2px dashed rgba(255,255,255,0.5);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .upload-area:hover {
            border-color: white;
            background: rgba(255,255,255,0.1);
        }
        
        .upload-area.dragover {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }
        
        .data-preview {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        /* æ•°æ®ç‚¹æ‚¬åœæç¤º */
        .chart-tooltip {
            position: absolute;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            pointer-events: none;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .chart-tooltip.show {
            opacity: 1;
        }
        
        /* é«˜äº®æ•ˆæœ */
        .highlight-point {
            filter: brightness(1.2) drop-shadow(0 0 10px rgba(255,255,0,0.8));
            transition: all 0.3s ease;
        }
        
        @media (max-width: 768px) {
            .nav-tabs { flex-direction: column; align-items: center; }
            .grid-2x2, .grid-1x2 { grid-template-columns: 1fr; }
            header h1 { font-size: 2em; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“Š ç¬¬5ç« äº¤äº’å¼å›¾è¡¨æ¼”ç¤º</h1>
            <p>å°†Matplotlibé™æ€å›¾è¡¨è½¬æ¢ä¸ºPlotlyäº¤äº’å¼ç»„ä»¶</p>
        </header>
        
        <nav>
            <div class="nav-tabs">
                <div class="nav-tab active" data-section="section-51">5.1 å›ºå®šåŒºåŸŸå­å›¾</div>
                <div class="nav-tab" data-section="section-52">5.2 è‡ªå®šä¹‰åŒºåŸŸå­å›¾</div>
                <div class="nav-tab" data-section="section-53">5.3 å…±äº«åæ ‡è½´</div>
                <div class="nav-tab" data-section="section-54">5.4 å­å›¾å¸ƒå±€</div>
            </div>
        </nav>
        
        <main>
            <!-- æ•°æ®ä¸Šä¼ å’Œç®¡ç†åŒºåŸŸ -->
            <section class="data-upload-section">
                <h3>ğŸ“Š æ•°æ®ç®¡ç†ä¸­å¿ƒ</h3>
                <div class="upload-area" id="uploadArea">
                    <p>ğŸ“ ç‚¹å‡»é€‰æ‹©æ–‡ä»¶æˆ–æ‹–æ‹½CSV/JSONæ–‡ä»¶åˆ°æ­¤å¤„</p>
                    <input type="file" id="fileInput" accept=".csv,.json" style="display: none;">
                    <button onclick="document.getElementById('fileInput').click()" style="margin-top: 10px; padding: 8px 20px; background: white; color: #667eea; border: none; border-radius: 5px; cursor: pointer;">é€‰æ‹©æ–‡ä»¶</button>
                </div>
                <div class="data-preview" id="dataPreview" style="display: none;">
                    <h4>æ•°æ®é¢„è§ˆï¼š</h4>
                    <div id="previewContent"></div>
                    <button onclick="applyUploadedData()" style="margin-top: 10px; padding: 8px 20px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">åº”ç”¨æ•°æ®åˆ°å›¾è¡¨</button>
                </div>
            </section>

            <!-- åŠ¨æ€æ§ä»¶åŒºåŸŸ -->
            <section class="interactive-controls">
                <h3>ğŸ›ï¸ å›¾è¡¨å‚æ•°æ§åˆ¶</h3>
                
                <div class="control-group">
                    <label>å›¾è¡¨é€æ˜åº¦:</label>
                    <input type="range" id="opacitySlider" min="0.1" max="1" step="0.1" value="0.8">
                    <span class="value-display" id="opacityValue">0.8</span>
                </div>
                
                <div class="control-group">
                    <label>çº¿æ¡ç²—ç»†:</label>
                    <input type="range" id="lineWidthSlider" min="1" max="10" step="1" value="3">
                    <span class="value-display" id="lineWidthValue">3</span>
                </div>
                
                <div class="control-group">
                    <label>åŠ¨ç”»é€Ÿåº¦(ç§’):</label>
                    <input type="range" id="animationSpeedSlider" min="0.5" max="5" step="0.5" value="2">
                    <span class="value-display" id="animationSpeedValue">2.0</span>
                </div>
                
                <div class="control-group">
                    <label>å›¾è¡¨ä¸»é¢˜:</label>
                    <select id="themeSelector">
                        <option value="plotly_white">ç™½è‰²ä¸»é¢˜</option>
                        <option value="plotly_dark">æ·±è‰²ä¸»é¢˜</option>
                        <option value="ggplot2">GGplotä¸»é¢˜</option>
                        <option value="seaborn">Seabornä¸»é¢˜</option>
                    </select>
                </div>
            </section>
            
            <!-- 5.1 å›ºå®šåŒºåŸŸå­å›¾ -->
            <div id="section-51" class="content-section active">
                <div class="description">
                    <h3>5.1 å›ºå®šåŒºåŸŸå­å›¾ - æ¦‚è¿°</h3>
                    <p>ä½¿ç”¨subplot()å’Œsubplots()åˆ›å»ºè§„åˆ™å¸ƒå±€çš„å­å›¾ï¼Œæ”¯æŒç­‰åˆ†åŒºåŸŸçš„å›¾è¡¨æ’åˆ—ã€‚</p>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">äº§å“Aä¸äº§å“Bé”€å”®é¢å¯¹æ¯”</div>
                    <div class="grid-layout grid-2x2">
                        <div id="chart51-1" class="chart-wrapper"></div>
                        <div id="chart51-2" class="chart-wrapper"></div>
                        <div id="chart51-3" class="chart-wrapper"></div>
                        <div id="chart51-4" class="chart-wrapper"></div>
                    </div>
                </div>
            </div>
            
            <!-- 5.2 è‡ªå®šä¹‰åŒºåŸŸå­å›¾ -->
            <div id="section-52" class="content-section">
                <div class="description">
                    <h3>5.2 è‡ªå®šä¹‰åŒºåŸŸå­å›¾ - æ¦‚è¿°</h3>
                    <p>ä½¿ç”¨subplot2grid()åˆ›å»ºä¸è§„åˆ™å¸ƒå±€çš„å­å›¾ï¼Œå¯ä»¥è·¨è¡Œè·¨åˆ—å®ç°å¤æ‚å¸ƒå±€ã€‚</p>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">2017å¹´ä¸2018å¹´æŠ–éŸ³ç”¨æˆ·åˆ†æ</div>
                    <div class="grid-layout grid-1x2">
                        <div id="chart52-1" class="chart-wrapper" style="grid-row: 1; grid-column: 1 / span 2;"></div>
                        <div id="chart52-2" class="chart-wrapper" style="grid-row: 2; grid-column: 1;"></div>
                        <div id="chart52-3" class="chart-wrapper" style="grid-row: 2; grid-column: 2;"></div>
                    </div>
                </div>
            </div>
            
            <!-- 5.3 å…±äº«åæ ‡è½´ -->
            <div id="section-53" class="content-section">
                <div class="description">
                    <h3>5.3 å…±äº«åæ ‡è½´ - æ¦‚è¿°</h3>
                    <p>å¤šä¸ªå­å›¾å…±äº«åŒä¸€åæ ‡è½´ï¼Œä¾¿äºæ•°æ®å¯¹æ¯”åˆ†æã€‚</p>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">æ°”æ¸©ä¸é™æ°´é‡ã€è’¸å‘é‡çš„å…³ç³»</div>
                    <div id="chart53" class="chart-wrapper" style="height: 500px;"></div>
                </div>
            </div>
            
            <!-- 5.4 å­å›¾å¸ƒå±€ -->
            <div id="section-54" class="content-section">
                <div class="description">
                    <h3>5.4 å­å›¾å¸ƒå±€ - æ¦‚è¿°</h3>
                    <p>çµæ´»çš„å­å›¾å¸ƒå±€æ–¹å¼ï¼šçº¦æŸå¸ƒå±€ã€ç´§å¯†å¸ƒå±€ã€è‡ªå®šä¹‰å¸ƒå±€ã€‚</p>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">2018å¹´ä¸ŠåŠå¹´æ±½è½¦é”€å”®æƒ…å†µ</div>
                    <div class="grid-layout grid-2x2">
                        <div id="chart54-1" class="chart-wrapper" style="grid-column: 1 / span 2;"></div>
                        <div id="chart54-2" class="chart-wrapper"></div>
                        <div id="chart54-3" class="chart-wrapper"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // æ•°æ®å®šä¹‰
        const chartData = {
            // 5.1 äº§å“é”€å”®æ•°æ®
            productSales: {
                months: ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ', '7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ', '12æœˆ'],
                productA: [20, 28, 23, 16, 29, 36, 39, 33, 31, 19, 21, 25],
                productB: [17, 22, 39, 26, 35, 23, 25, 27, 29, 38, 28, 20]
            },
            
            // 5.2 æŠ–éŸ³ç”¨æˆ·æ•°æ®
            douyinData: {
                labels: ['ä¸€çº¿åŸå¸‚', 'äºŒçº¿åŸå¸‚', 'ä¸‰çº¿åŸå¸‚', 'å››çº¿åŠä»¥å¤–', 'å…¶ä»–å›½å®¶åŠåœ°åŒº'],
                growth2017: [21, 35, 22, 19, 3],
                growth2018: [13, 32, 27, 27, 1],
                growthMultiple: [51, 73, 99, 132, 45],
                distribution2017: [21, 35, 22, 19, 3],
                distribution2018: [13, 32, 27, 27, 1]
            },
            
            // 5.3 æ°”è±¡æ•°æ®
            weatherData: {
                months: ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ', '7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ', '12æœˆ'],
                temperature: [2.0, 2.2, 3.3, 4.5, 6.3, 10.2, 20.3, 33.4, 23.0, 16.5, 12.0, 6.2],
                precipitation: [2.6, 5.9, 9.0, 26.4, 28.7, 70.7, 175.6, 182.2, 48.7, 18.8, 6.0, 2.3],
                evaporation: [2.0, 4.9, 7.0, 23.2, 25.6, 76.7, 135.6, 162.2, 32.6, 20.0, 6.4, 3.3]
            },
            
            // 5.4 æ±½è½¦é”€å”®æ•°æ®
            carSales: {
                months: ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ'],
                sales: [2150, 1050, 1560, 1480, 1530, 1490],
                cities: ['åŒ—äº¬', 'ä¸Šæµ·', 'å¹¿å·', 'æ·±åœ³', 'æµ™æ±Ÿ', 'å±±ä¸œ'],
                salesCount: [83775, 62860, 59176, 64205, 48671, 39968]
            }
        };
        
        // å¯¼èˆªåˆ‡æ¢åŠŸèƒ½
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                // ç§»é™¤æ‰€æœ‰activeç±»
                document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
                
                // æ·»åŠ activeç±»åˆ°å½“å‰é€‰ä¸­çš„
                this.classList.add('active');
                const sectionId = this.getAttribute('data-section');
                document.getElementById(sectionId).classList.add('active');
                
                // åˆå§‹åŒ–å¯¹åº”éƒ¨åˆ†çš„å›¾è¡¨
                initializeSection(sectionId);
            });
        });
        
        // åˆå§‹åŒ–å¯¹åº”éƒ¨åˆ†çš„å›¾è¡¨
        function initializeSection(sectionId) {
            switch(sectionId) {
                case 'section-51':
                    updateChart51();
                    break;
                case 'section-52':
                    updateChart52();
                    break;
                case 'section-53':
                    updateChart53();
                    break;
                case 'section-54':
                    updateChart54();
                    break;
            }
        }
        
        // 5.1 å›ºå®šåŒºåŸŸå­å›¾åŠŸèƒ½
        function updateChart51_original() {
            const data = chartData.productSales;
            
            // ç¬¬ä¸€ä¸ªå­å›¾ï¼šæŠ˜çº¿å›¾
            const trace1 = {
                x: data.months,
                y: data.productA,
                type: 'scatter',
                mode: 'lines+markers',
                name: 'äº§å“A',
                line: { color: 'magenta', width: 2 },
                marker: { size: 5 }
            };
            
            const trace2 = {
                x: data.months,
                y: data.productB,
                type: 'scatter',
                mode: 'lines+markers',
                name: 'äº§å“B',
                line: { color: 'green', width: 2 },
                marker: { size: 5 }
            };
            
            Plotly.newPlot('chart51-1', [trace1, trace2], {
                title: 'äº§å“Aä¸äº§å“Bçš„é”€å”®é¢',
                xaxis: { title: 'æœˆä»½' },
                yaxis: { title: 'é”€å”®é¢(äº¿å…ƒ)', range: [10, 45] },
                margin: { t: 40, r: 20, b: 60, l: 60 }
            });
            
            // ç¬¬äºŒä¸ªå­å›¾ï¼šäº§å“Aé¥¼å›¾
            const pie1 = {
                labels: data.months,
                values: data.productA,
                type: 'pie',
                name: 'äº§å“Aé”€å”®é¢',
                hole: 0.5,
                marker: { colors: ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E2', '#F8B739', '#52D726'] }
            };
            
            Plotly.newPlot('chart51-2', [pie1], {
                title: 'äº§å“Açš„é”€å”®é¢',
                margin: { t: 40, r: 20, b: 20, l: 20 }
            });
            
            // ç¬¬ä¸‰ä¸ªå­å›¾ï¼šäº§å“Bé¥¼å›¾
            const pie2 = {
                labels: data.months,
                values: data.productB,
                type: 'pie',
                name: 'äº§å“Bé”€å”®é¢',
                hole: 0.5,
                marker: { colors: ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E2', '#F8B739', '#52D726'] }
            };
            
            Plotly.newPlot('chart51-3', [pie2], {
                title: 'äº§å“Bçš„é”€å”®é¢',
                margin: { t: 40, r: 20, b: 20, l: 20 }
            });
            
            // ç¬¬å››ä¸ªå­å›¾ï¼šç©ºçš„ï¼ˆä¿æŒå¸ƒå±€ä¸€è‡´æ€§ï¼‰
            Plotly.newPlot('chart51-4', [], {
                title: 'é¢„ç•™ä½ç½®',
                margin: { t: 40, r: 20, b: 20, l: 20 }
            });
        }
        
        // 5.2 è‡ªå®šä¹‰åŒºåŸŸå­å›¾åŠŸèƒ½
        function updateChart52() {
            const data = chartData.douyinData;
            
            // ç¬¬ä¸€ä¸ªå¤§å­å›¾ï¼šå¢é•¿å€æ•°æŸ±çŠ¶å›¾
            const growthTrace = {
                x: data.labels,
                y: data.growthMultiple,
                type: 'bar',
                name: 'å¢é•¿å€æ•°',
                marker: { color: '#20B2AA', width: 0.5 },
                opacity: currentSettings.opacity
            };
            
            // æ·»åŠ å¹³å‡çº¿
            const averageLine = {
                x: data.labels,
                y: Array(data.labels.length).fill(75),
                type: 'scatter',
                mode: 'lines',
                name: 'å¹³å‡å¢é•¿å€æ•°',
                line: { color: 'gray', width: currentSettings.lineWidth, dash: 'dash' },
                opacity: currentSettings.opacity
            };
            
            const layout1 = {
                title: 'æŠ–éŸ³2018vs2017äººç¾¤å¢é•¿å€æ•°',
                xaxis: { title: 'åœ°åŒº' },
                yaxis: { title: 'å¢é•¿å€æ•°', range: [0, 160] },
                margin: { t: 40, r: 20, b: 80, l: 60 },
                template: currentSettings.theme,
                transition: {
                    duration: currentSettings.animationSpeed * 1000,
                    easing: 'cubic-in-out'
                }
            };
            
            Plotly.newPlot('chart52-1', [growthTrace, averageLine], layout1)
                .then(() => addChartInteraction('chart52-1'));
            
            // ç¬¬äºŒä¸ªå­å›¾ï¼š2017å¹´ç”¨æˆ·åˆ†å¸ƒ
            const pie2017 = {
                labels: data.labels,
                values: data.distribution2017,
                type: 'pie',
                name: '2017å¹´æŠ–éŸ³ç”¨æˆ·åœ°åŒºåˆ†å¸ƒ',
                marker: { colors: ['#2F4F4F', '#FF0000', '#A9A9A9', '#FFD700', '#B0C4DE'] },
                opacity: currentSettings.opacity
            };
            
            const layout2 = {
                title: '2017å¹´æŠ–éŸ³ç”¨æˆ·åœ°åŒºåˆ†å¸ƒçš„æ¯”ä¾‹',
                margin: { t: 40, r: 20, b: 20, l: 20 },
                template: currentSettings.theme,
                transition: {
                    duration: currentSettings.animationSpeed * 1000,
                    easing: 'cubic-in-out'
                }
            };
            
            Plotly.newPlot('chart52-2', [pie2017], layout2)
                .then(() => addChartInteraction('chart52-2'));
            
            // ç¬¬ä¸‰ä¸ªå­å›¾ï¼š2018å¹´ç”¨æˆ·åˆ†å¸ƒ
            const pie2018 = {
                labels: data.labels,
                values: data.distribution2018,
                type: 'pie',
                name: '2018å¹´æŠ–éŸ³ç”¨æˆ·åœ°åŒºåˆ†å¸ƒ',
                marker: { colors: ['#2F4F4F', '#FF0000', '#A9A9A9', '#FFD700', '#B0C4DE'] },
                opacity: currentSettings.opacity
            };
            
            const layout3 = {
                title: '2018å¹´æŠ–éŸ³ç”¨æˆ·åœ°åŒºåˆ†å¸ƒçš„æ¯”ä¾‹',
                margin: { t: 40, r: 20, b: 20, l: 20 },
                template: currentSettings.theme,
                transition: {
                    duration: currentSettings.animationSpeed * 1000,
                    easing: 'cubic-in-out'
                }
            };
            
            Plotly.newPlot('chart52-3', [pie2018], layout3)
                .then(() => addChartInteraction('chart52-3'));
        }
        
        // 5.3 å…±äº«åæ ‡è½´å­å›¾åŠŸèƒ½
        function updateChart53() {
            const data = chartData.weatherData;
            const traces = [];
            
            // å †å æŸ±çŠ¶å›¾ - é™æ°´é‡å’Œè’¸å‘é‡
            traces.push({
                x: data.months,
                y: data.evaporation,
                type: 'bar',
                name: 'è’¸å‘é‡',
                marker: { color: 'orange' },
                opacity: currentSettings.opacity
            });
            
            traces.push({
                x: data.months,
                y: data.precipitation,
                type: 'bar',
                name: 'é™æ°´é‡',
                marker: { color: 'green' },
                opacity: currentSettings.opacity
            });
            
            // çº¿å›¾ - æ°”æ¸©ï¼ˆä½¿ç”¨æ¬¡åæ ‡è½´ï¼‰
            traces.push({
                x: data.months,
                y: data.temperature,
                type: 'scatter',
                mode: 'lines+markers',
                name: 'å¹³å‡æ°”æ¸©',
                yaxis: 'y2',
                line: { color: 'magenta', width: currentSettings.lineWidth },
                marker: { size: 6, symbol: 'circle' },
                opacity: currentSettings.opacity
            });
            
            const layout = {
                title: 'å¹³å‡æ°”æ¸©ä¸é™æ°´é‡ã€è’¸å‘é‡çš„å…³ç³»',
                xaxis: { title: 'æœˆä»½' },
                yaxis: {
                    title: 'æ°´é‡ (ml)',
                    titlefont: { color: '#1f77b4' },
                    tickfont: { color: '#1f77b4' }
                },
                yaxis2: {
                    title: 'æ°”æ¸©(Â°C)',
                    titlefont: { color: '#ff7f0e' },
                    tickfont: { color: '#ff7f0e' },
                    overlaying: 'y',
                    side: 'right'
                },
                barmode: 'stack',
                legend: {
                    x: 0.02,
                    y: 0.98,
                    bgcolor: 'rgba(255, 255, 255, 0.8)',
                    bordercolor: '#333',
                    borderwidth: 1
                },
                margin: { t: 50, r: 60, b: 60, l: 80 },
                template: currentSettings.theme,
                transition: {
                    duration: currentSettings.animationSpeed * 1000,
                    easing: 'cubic-in-out'
                }
            };
            
            Plotly.newPlot('chart53', traces, layout)
                .then(() => addChartInteraction('chart53'));
        }
        
        // 5.4 å­å›¾å¸ƒå±€åŠŸèƒ½
        function updateChart54() {
            const data = chartData.carSales;
            
            // ç¬¬ä¸€ä¸ªå­å›¾ï¼šæœˆåº¦é”€å”®é¢æŸ±çŠ¶å›¾ï¼ˆå æ®æ•´è¡Œï¼‰
            const salesTrace = {
                x: data.months,
                y: data.sales,
                type: 'bar',
                name: 'é”€å”®é¢',
                marker: { color: '#3299CC', width: 0.5 },
                opacity: currentSettings.opacity
            };
            
            const layout1 = {
                title: '2018å¹´ä¸ŠåŠå¹´æŸå“ç‰Œæ±½è½¦çš„é”€å”®é¢',
                yaxis: { title: 'é”€å”®é¢(äº¿å…ƒ)' },
                margin: { t: 40, r: 20, b: 60, l: 60 },
                template: currentSettings.theme,
                transition: {
                    duration: currentSettings.animationSpeed * 1000,
                    easing: 'cubic-in-out'
                }
            };
            
            Plotly.newPlot('chart54-1', [salesTrace], layout1)
                .then(() => addChartInteraction('chart54-1'));
            
            // ç¬¬äºŒä¸ªå­å›¾ï¼šåˆ†å…¬å¸é”€é‡æŠ˜çº¿å›¾
            const salesCountTrace = {
                x: data.cities,
                y: data.salesCount,
                type: 'scatter',
                mode: 'lines+markers',
                name: 'é”€é‡',
                line: { color: 'magenta', width: currentSettings.lineWidth },
                marker: { size: 8 },
                opacity: currentSettings.opacity
            };
            
            const layout2 = {
                title: 'åˆ†å…¬å¸æŸå“ç‰Œæ±½è½¦çš„é”€é‡',
                yaxis: { title: 'é”€é‡(è¾†)' },
                margin: { t: 40, r: 20, b: 60, l: 60 },
                template: currentSettings.theme,
                transition: {
                    duration: currentSettings.animationSpeed * 1000,
                    easing: 'cubic-in-out'
                }
            };
            
            Plotly.newPlot('chart54-2', [salesCountTrace], layout2)
                .then(() => addChartInteraction('chart54-2'));
            
            // ç¬¬ä¸‰ä¸ªå­å›¾ï¼šåˆ†å…¬å¸é”€é‡å †å é¢ç§¯å›¾
            const stackTrace = {
                x: data.cities,
                y: data.salesCount,
                type: 'scatter',
                mode: 'none',
                fill: 'tozeroy',
                name: 'é”€é‡',
                fillcolor: 'rgba(153, 153, 255, 0.5)',
                opacity: currentSettings.opacity
            };
            
            const layout3 = {
                title: 'åˆ†å…¬å¸æŸå“ç‰Œæ±½è½¦çš„é”€é‡',
                yaxis: { title: 'é”€é‡(è¾†)' },
                margin: { t: 40, r: 20, b: 60, l: 60 },
                template: currentSettings.theme,
                transition: {
                    duration: currentSettings.animationSpeed * 1000,
                    easing: 'cubic-in-out'
                }
            };
            
            Plotly.newPlot('chart54-3', [stackTrace], layout3)
                .then(() => addChartInteraction('chart54-3'));
        }
        
        // å…¨å±€å˜é‡å­˜å‚¨ä¸Šä¼ çš„æ•°æ®
        let uploadedData = null;
        let currentSettings = {
            opacity: 0.8,
            lineWidth: 3,
            animationSpeed: 2,
            theme: 'plotly_white'
        };

        // === æ•°æ®ä¸Šä¼ å’Œç®¡ç†åŠŸèƒ½ ===
        
        // æ–‡ä»¶ä¸Šä¼ å¤„ç†
        document.getElementById('fileInput').addEventListener('change', handleFileUpload);
        
        // æ‹–æ‹½ä¸Šä¼ åŠŸèƒ½
        const uploadArea = document.getElementById('uploadArea');
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });
        
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                handleFile(file);
            }
        }
        
        function handleFile(file) {
            const fileType = file.name.split('.').pop().toLowerCase();
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const content = e.target.result;
                
                try {
                    if (fileType === 'json') {
                        uploadedData = JSON.parse(content);
                    } else if (fileType === 'csv') {
                        uploadedData = parseCSV(content);
                    }
                    
                    showDataPreview(uploadedData);
                    showToast('æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼', 'success');
                } catch (error) {
                    showToast('æ–‡ä»¶è§£æå¤±è´¥ï¼š' + error.message, 'error');
                }
            };
            
            reader.readAsText(file);
        }
        
        function parseCSV(content) {
            const lines = content.split('\n').filter(line => line.trim());
            const headers = lines[0].split(',').map(h => h.trim());
            const data = {};
            
            headers.forEach(header => {
                data[header] = [];
            });
            
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',').map(v => v.trim());
                headers.forEach((header, index) => {
                    const value = values[index];
                    data[header].push(isNaN(value) ? value : parseFloat(value));
                });
            }
            
            return data;
        }
        
        function showDataPreview(data) {
            const preview = document.getElementById('dataPreview');
            const content = document.getElementById('previewContent');
            
            let html = '<table style="width: 100%; border-collapse: collapse; color: white;">';
            
            if (Array.isArray(data)) {
                html += '<tr><th>ç´¢å¼•</th><th>å€¼</th></tr>';
                data.forEach((item, index) => {
                    html += `<tr><td>${index}</td><td>${JSON.stringify(item)}</td></tr>`;
                });
            } else if (typeof data === 'object') {
                html += '<tr><th>é”®</th><th>å€¼</th></tr>';
                Object.entries(data).forEach(([key, value]) => {
                    html += `<tr><td>${key}</td><td>${Array.isArray(value) ? value.slice(0, 5).join(', ') + '...' : JSON.stringify(value)}</td></tr>`;
                });
            }
            
            html += '</table>';
            content.innerHTML = html;
            preview.style.display = 'block';
        }
        
        function applyUploadedData() {
            if (!uploadedData) {
                showToast('æ²¡æœ‰å¯åº”ç”¨çš„æ•°æ®', 'warning');
                return;
            }
            
            // å°è¯•å°†ä¸Šä¼ çš„æ•°æ®åº”ç”¨åˆ°å½“å‰æ´»åŠ¨ç« èŠ‚çš„å›¾è¡¨
            const activeSection = document.querySelector('.content-section.active');
            const sectionId = activeSection.id;
            
            try {
                switch(sectionId) {
                    case 'section-51':
                        if (uploadedData.months && uploadedData.productA && uploadedData.productB) {
                            chartData.productSales = uploadedData;
                        } else {
                            // å°è¯•è‡ªé€‚åº”æ˜ å°„
                            adaptDataToChart51(uploadedData);
                        }
                        break;
                    case 'section-52':
                        if (uploadedData.labels) {
                            chartData.douyinData = uploadedData;
                        } else {
                            adaptDataToChart52(uploadedData);
                        }
                        break;
                    case 'section-53':
                        if (uploadedData.months) {
                            chartData.weatherData = uploadedData;
                        } else {
                            adaptDataToChart53(uploadedData);
                        }
                        break;
                    case 'section-54':
                        if (uploadedData.months) {
                            chartData.carSales = uploadedData;
                        } else {
                            adaptDataToChart54(uploadedData);
                        }
                        break;
                }
                
                initializeSection(sectionId);
                showToast('æ•°æ®å·²æˆåŠŸåº”ç”¨åˆ°å›¾è¡¨ï¼', 'success');
            } catch (error) {
                showToast('æ•°æ®åº”ç”¨å¤±è´¥ï¼š' + error.message, 'error');
            }
        }
        
        function adaptDataToChart51(data) {
            // å°è¯•æ™ºèƒ½æ˜ å°„æ•°æ®åˆ°5.1æ ¼å¼
            const keys = Object.keys(data);
            if (keys.length >= 3) {
                chartData.productSales = {
                    months: data[keys[0]] || chartData.productSales.months,
                    productA: data[keys[1]] || chartData.productSales.productA,
                    productB: data[keys[2]] || chartData.productSales.productB
                };
            }
        }
        
        function adaptDataToChart52(data) {
            const keys = Object.keys(data);
            if (keys.length >= 1) {
                chartData.douyinData.labels = data[keys[0]] || chartData.douyinData.labels;
                // ä¸ºå…¶ä»–å­—æ®µç”Ÿæˆéšæœºæ•°æ®
                const length = chartData.douyinData.labels.length;
                chartData.douyinData.growthMultiple = Array.from({length}, () => Math.floor(Math.random() * 150) + 10);
                chartData.douyinData.distribution2017 = Array.from({length}, () => Math.floor(Math.random() * 40) + 10);
                chartData.douyinData.distribution2018 = Array.from({length}, () => Math.floor(Math.random() * 40) + 10);
            }
        }
        
        function adaptDataToChart53(data) {
            const keys = Object.keys(data);
            if (keys.length >= 1) {
                chartData.weatherData.months = data[keys[0]] || chartData.weatherData.months;
                const length = chartData.weatherData.months.length;
                chartData.weatherData.temperature = Array.from({length}, () => Math.random() * 35 + 5);
                chartData.weatherData.precipitation = Array.from({length}, () => Math.random() * 200 + 10);
                chartData.weatherData.evaporation = Array.from({length}, () => Math.random() * 180 + 5);
            }
        }
        
        function adaptDataToChart54(data) {
            const keys = Object.keys(data);
            if (keys.length >= 1) {
                chartData.carSales.months = data[keys[0]] || chartData.carSales.months;
                const length = chartData.carSales.months.length;
                chartData.carSales.sales = Array.from({length}, () => Math.floor(Math.random() * 2000) + 1000);
                chartData.carSales.cities = Array.from({length: 6}, (_, i) => 'åŸå¸‚' + (i + 1));
                chartData.carSales.salesCount = Array.from({length: 6}, () => Math.floor(Math.random() * 80000) + 30000);
            }
        }

        // === åŠ¨æ€æ§ä»¶åŠŸèƒ½ ===
        
        // é€æ˜åº¦æ§åˆ¶
        document.getElementById('opacitySlider').addEventListener('input', function() {
            currentSettings.opacity = parseFloat(this.value);
            document.getElementById('opacityValue').textContent = this.value;
            updateAllCharts();
        });
        
        // çº¿æ¡ç²—ç»†æ§åˆ¶
        document.getElementById('lineWidthSlider').addEventListener('input', function() {
            currentSettings.lineWidth = parseInt(this.value);
            document.getElementById('lineWidthValue').textContent = this.value;
            updateAllCharts();
        });
        
        // åŠ¨ç”»é€Ÿåº¦æ§åˆ¶
        document.getElementById('animationSpeedSlider').addEventListener('input', function() {
            currentSettings.animationSpeed = parseFloat(this.value);
            document.getElementById('animationSpeedValue').textContent = this.value;
        });
        
        // ä¸»é¢˜é€‰æ‹©
        document.getElementById('themeSelector').addEventListener('change', function() {
            currentSettings.theme = this.value;
            updateAllCharts();
        });
        
        function updateAllCharts() {
            const activeSection = document.querySelector('.content-section.active');
            if (activeSection) {
                initializeSection(activeSection.id);
            }
        }
        
        // === æ•°æ®ç‚¹äº¤äº’åŠŸèƒ½ ===
        
        function addChartInteraction(chartId) {
            const chartElement = document.getElementById(chartId);
            if (!chartElement) return;
            
            // ä¸ºå›¾è¡¨æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬
            chartElement.on('plotly_click', function(data) {
                const point = data.points[0];
                if (point) {
                    highlightPoint(chartId, point);
                    showPointDetails(point);
                }
            });
            
            // ä¸ºå›¾è¡¨æ·»åŠ æ‚¬åœäº‹ä»¶ç›‘å¬
            chartElement.on('plotly_hover', function(data) {
                const point = data.points[0];
                if (point) {
                    showTooltip(point, event);
                }
            });
            
            chartElement.on('plotly_unhover', function() {
                hideTooltip();
            });
        }
        
        function highlightPoint(chartId, point) {
            // åˆ›å»ºé«˜äº®æ•ˆæœ
            const update = {
                'marker.size': point.marker.size + 5,
                'marker.color': 'rgba(255, 255, 0, 0.8)'
            };
            
            Plotly.restyle(chartId, update, [point.curveNumber]);
            
            // 3ç§’åæ¢å¤åŸçŠ¶
            setTimeout(() => {
                const originalUpdate = {
                    'marker.size': point.marker.size - 5,
                    'marker.color': point.marker.color
                };
                Plotly.restyle(chartId, originalUpdate, [point.curveNumber]);
            }, 3000);
        }
        
        function showPointDetails(point) {
            const details = `
                <strong>æ•°æ®ç‚¹è¯¦æƒ…ï¼š</strong><br>
                X: ${point.x}<br>
                Y: ${point.y}<br>
                ç³»åˆ—: ${point.data.name || 'æœªçŸ¥'}
            `;
            showToast(details, 'info', 5000);
        }
        
        function showTooltip(point, event) {
            let tooltip = document.getElementById('chartTooltip');
            if (!tooltip) {
                tooltip = document.createElement('div');
                tooltip.id = 'chartTooltip';
                tooltip.className = 'chart-tooltip';
                document.body.appendChild(tooltip);
            }
            
            tooltip.innerHTML = `
                <strong>${point.data.name || 'æ•°æ®'}</strong><br>
                X: ${point.x}<br>
                Y: ${point.y}
            `;
            
            tooltip.style.left = event.pageX + 10 + 'px';
            tooltip.style.top = event.pageY - 30 + 'px';
            tooltip.classList.add('show');
        }
        
        function hideTooltip() {
            const tooltip = document.getElementById('chartTooltip');
            if (tooltip) {
                tooltip.classList.remove('show');
            }
        }
        
        // === Toast é€šçŸ¥ç³»ç»Ÿ ===
        
        function showToast(message, type = 'info', duration = 3000) {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 8px;
                color: white;
                font-weight: 500;
                z-index: 10000;
                opacity: 0;
                transform: translateX(100%);
                transition: all 0.3s ease;
                max-width: 300px;
                word-wrap: break-word;
            `;
            
            // æ ¹æ®ç±»å‹è®¾ç½®èƒŒæ™¯è‰²
            const colors = {
                success: '#4CAF50',
                error: '#f44336',
                warning: '#ff9800',
                info: '#2196F3'
            };
            toast.style.background = colors[type] || colors.info;
            
            toast.innerHTML = message;
            document.body.appendChild(toast);
            
            // æ˜¾ç¤ºåŠ¨ç”»
            setTimeout(() => {
                toast.style.opacity = '1';
                toast.style.transform = 'translateX(0)';
            }, 100);
            
            // è‡ªåŠ¨éšè—
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, duration);
        }
        
        // === ä¿®æ”¹å›¾è¡¨åˆ›å»ºå‡½æ•°ä»¥æ”¯æŒæ–°åŠŸèƒ½ ===
        
        // ä¿®æ”¹updateChart51å‡½æ•°ä»¥åº”ç”¨å½“å‰è®¾ç½®
        function updateChart51() {
            const data = chartData.productSales;
            
            // ç¬¬ä¸€ä¸ªå­å›¾ï¼šæŠ˜çº¿å›¾
            const trace1 = {
                x: data.months,
                y: data.productA,
                type: 'scatter',
                mode: 'lines+markers',
                name: 'äº§å“A',
                line: { color: 'magenta', width: currentSettings.lineWidth },
                marker: { size: 5 },
                opacity: currentSettings.opacity
            };
            
            const trace2 = {
                x: data.months,
                y: data.productB,
                type: 'scatter',
                mode: 'lines+markers',
                name: 'äº§å“B',
                line: { color: 'green', width: currentSettings.lineWidth },
                marker: { size: 5 },
                opacity: currentSettings.opacity
            };
            
            const layout = {
                title: 'äº§å“Aä¸äº§å“Bçš„é”€å”®é¢',
                xaxis: { title: 'æœˆä»½' },
                yaxis: { title: 'é”€å”®é¢(äº¿å…ƒ)', range: [10, 45] },
                margin: { t: 40, r: 20, b: 60, l: 60 },
                template: currentSettings.theme,
                transition: {
                    duration: currentSettings.animationSpeed * 1000,
                    easing: 'cubic-in-out'
                }
            };
            
            Plotly.newPlot('chart51-1', [trace1, trace2], layout)
                .then(() => addChartInteraction('chart51-1'));
            
            // ç¬¬äºŒä¸ªå­å›¾ï¼šäº§å“Aé¥¼å›¾
            const pie1 = {
                labels: data.months,
                values: data.productA,
                type: 'pie',
                name: 'äº§å“Aé”€å”®é¢',
                hole: 0.5,
                marker: { colors: ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E2', '#F8B739', '#52D726'] },
                opacity: currentSettings.opacity
            };
            
            const pieLayout1 = {
                title: 'äº§å“Açš„é”€å”®é¢',
                margin: { t: 40, r: 20, b: 20, l: 20 },
                template: currentSettings.theme,
                transition: {
                    duration: currentSettings.animationSpeed * 1000,
                    easing: 'cubic-in-out'
                }
            };
            
            Plotly.newPlot('chart51-2', [pie1], pieLayout1)
                .then(() => addChartInteraction('chart51-2'));
            
            // ç¬¬ä¸‰ä¸ªå­å›¾ï¼šäº§å“Bé¥¼å›¾
            const pie2 = {
                labels: data.months,
                values: data.productB,
                type: 'pie',
                name: 'äº§å“Bé”€å”®é¢',
                hole: 0.5,
                marker: { colors: ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E2', '#F8B739', '#52D726'] },
                opacity: currentSettings.opacity
            };
            
            const pieLayout2 = {
                title: 'äº§å“Bçš„é”€å”®é¢',
                margin: { t: 40, r: 20, b: 20, l: 20 },
                template: currentSettings.theme,
                transition: {
                    duration: currentSettings.animationSpeed * 1000,
                    easing: 'cubic-in-out'
                }
            };
            
            Plotly.newPlot('chart51-3', [pie2], pieLayout2)
                .then(() => addChartInteraction('chart51-3'));
            
            // ç¬¬å››ä¸ªå­å›¾ï¼šé”€å”®é¢å¯¹æ¯”æŸ±çŠ¶å›¾
            const comparisonTrace = {
                x: data.months,
                y: data.productA.map((val, idx) => val + data.productB[idx]),
                type: 'bar',
                name: 'æ€»é”€å”®é¢',
                marker: { color: 'rgba(75, 192, 192, 0.6)', width: 0.6 },
                opacity: currentSettings.opacity
            };
            
            const layout4 = {
                title: 'äº§å“Aä¸äº§å“Bæ€»é”€å”®é¢',
                xaxis: { title: 'æœˆä»½' },
                yaxis: { title: 'æ€»é”€å”®é¢(äº¿å…ƒ)' },
                margin: { t: 40, r: 20, b: 60, l: 60 },
                template: currentSettings.theme,
                transition: {
                    duration: currentSettings.animationSpeed * 1000,
                    easing: 'cubic-in-out'
                }
            };
            
            Plotly.newPlot('chart51-4', [comparisonTrace], layout4)
                .then(() => addChartInteraction('chart51-4'));
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–ç¬¬ä¸€ä¸ªéƒ¨åˆ†
        document.addEventListener('DOMContentLoaded', function() {
            updateChart51();
            showToast('æ¬¢è¿ä½¿ç”¨äº¤äº’å¼å›¾è¡¨æ¼”ç¤ºç³»ç»Ÿï¼', 'success', 4000);
        });
    </script>
</body>
</html>